--- 0. Defining Parameters for the 3-to-1 Factor Regime-Switching Model ---
Using device: cpu

--- 1. Generating Simulation Data from Regime-Switching Model ---
Simulation data generated.

--- 2. Defining Common Functions ---


--- 3. 3-Factor Model Evaluation (using True Parameters) ---
3-Factor Model Loss: 30005.3242, RMSE: 1.3778


--- 4. 1-Factor Model Evaluation (using True Parameters) ---
1-Factor Model Loss: 30746.5664, RMSE: 1.3850

--- 5. Defining the Prior for Weight Transition (75% switch assumption) ---
Prior assumes transition to a 25% / 75% final state.

--- 6. Implementing and Training the BPS Model with Prior ---
Starting SVI training...
[iteration 0500] loss: 37731.1942
[iteration 1000] loss: 35897.3775
[iteration 1500] loss: 34694.2407
[iteration 2000] loss: 34373.2356
SVI training finished.

--- 7. BPS Model RMSE Calculation and Visualization ---

Results plot saved to bps_weights_with_prior.png


--- 8. Final Model Fit Comparison ---
==================================================
Model                | Loss (Lower is Better)    | RMSE (Lower is Better)   
--------------------------------------------------
3-Factor Model       | 30005.3242                | 1.3778                   
1-Factor Model       | 30746.5664                | 1.3850                   
BPS Model (w/ Prior) | 34373.2356                | 1.3716                   
==================================================

Note: Loss for 3/1-Factor models is NegLogLikelihood. Loss for BPS is ELBO.
      These loss types are not directly comparable. RMSE is a directly comparable metric.
