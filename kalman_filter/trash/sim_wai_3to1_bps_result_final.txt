--- 0. Defining Parameters for the 3-to-1 Factor Regime-Switching Model ---
Using device: cpu

--- 1. Generating Simulation Data from Regime-Switching Model ---
Simulation data generated.
Average switch time point: 7.565789473684211

--- 2. Defining Common Functions ---

--- 5. Getting Predictions from Expert Models ---
Predictions from 3-Factor Model generated.
Predictions from 1-Factor Model generated.

--- 6. Implementing and Training the BPS Model with Pyro ---
Starting SVI training...
[iteration 0100] loss: 49352.6251
[iteration 0200] loss: 41718.3459
[iteration 0300] loss: 42020.2405
[iteration 0400] loss: 44464.6125
[iteration 0500] loss: 37218.6105
[iteration 0600] loss: 41230.7932
[iteration 0700] loss: 36483.3248
[iteration 0800] loss: 37745.9709
[iteration 0900] loss: 36899.2902
[iteration 1000] loss: 39593.9944
[iteration 1100] loss: 35527.9069
[iteration 1200] loss: 36637.3769
[iteration 1300] loss: 35196.3067
[iteration 1400] loss: 34758.6056
[iteration 1500] loss: 34815.6441
[iteration 1600] loss: 34562.4110
[iteration 1700] loss: 34282.4367
[iteration 1800] loss: 33977.6260
[iteration 1900] loss: 34206.9602
[iteration 2000] loss: 33924.6539
SVI training finished.

--- 7. Visualizing the BPS Model Results ---

Estimated Model Weights Over Time (Averaged over individuals):
Time | 3-Factor Weight | 1-Factor Weight
---------------------------------------
   0 | 0.5089          | 0.4911
   1 | 0.5210          | 0.4790
   2 | 0.5348          | 0.4652
   3 | 0.5393          | 0.4607
   4 | 0.5312          | 0.4688
   5 | 0.5167          | 0.4833
   6 | 0.5135          | 0.4865
   7 | 0.5157          | 0.4843
   8 | 0.5179          | 0.4821
   9 | 0.5174          | 0.4826
  10 | 0.5200          | 0.4800
  11 | 0.5157          | 0.4843
  12 | 0.5152          | 0.4848
  13 | 0.5146          | 0.4854
  14 | 0.5121          | 0.4879
  15 | 0.5035          | 0.4965
  16 | 0.4924          | 0.5076
  17 | 0.4764          | 0.5236
  18 | 0.4586          | 0.5414
  19 | 0.4530          | 0.5470

Results plot saved to bps_weights_over_time.png
