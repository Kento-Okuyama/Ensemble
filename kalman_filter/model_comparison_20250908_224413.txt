--- 0. Defining Parameters ---
Using device: cpu
Time series split: 20 for training, 5 for testing.

--- 1. Generating Simulation Data ---
Loading pre-computed simulation data from 'simulation_data_rw_forecast.pt'...
Data loading complete.

--- 2. Defining Common Functions ---

--- 3. Estimation of Baseline Models (on Training Data) ---

--- 3a. 3-Factor Model ---
Loading pre-trained 3-Factor model from 'trained_3fac_model_forecast.pt'...

--- 3b. 1-Factor Model ---
Loading pre-trained 1-Factor model from 'trained_1fac_model_forecast.pt'...

--- 4. Defining and Training BPS Random-Walk Model (on Training data) ---
Pre-calculating inputs for BPS model...
Pre-calculation complete.
Loading pre-trained BPS model guide from 'trained_bps_guide_params_forecast.pt'...


--- 5. Defining and Training the Regime-Switching Kalman Filter Model (on Training data) ---
Loading pre-computed RS-KF model results from 'rs_kf_results_forecast.pt'...

--- Part 6 & 7: Model Evaluation and Plotting Data Preparation ---

--- 6a. Evaluating Baseline models on Test Set ---

--- 6b. Evaluating BPS Model and Preparing Data ---
BPS model evaluation on test set complete.
Calculated 95% credible intervals for BPS model.

--- 6c. Evaluating RS-KF Model and Preparing Data ---
     -> Initializing FRS model with pre-trained baseline parameters.
     -> Initializing FRS HMM parameters by SAMPLING AROUND TRUE DGP values.
RS-KF model evaluation on test set complete.
Generated full-period probabilities for RS-KF model.

================================================================================================================================
Model                          | Train Loss      | Test RMSE       | Test Sensitivity | Test Specificity | Duration (s)    |
--------------------------------------------------------------------------------------------------------------------------------
3-Factor Model                 | 31012.5996      | 1.5325          | 0.0000          | 1.0000          | 0.00            |
1-Factor Model                 | 34330.6094      | 1.7681          | 1.0000          | 0.0000          | 0.00            |
BPS Random Walk                | -9999.0000      | 1.5678          | 0.1896          | 0.8870          | 0.00            |
Regime-Switching KF            | 30983.0508      | 1.5441          | 0.1013          | 0.9913          | 4853.06         |
Note: Loss for Baseline/RS-KF is NegLogLikelihood. Loss for BPS is ELBO.
      Metrics (RMSE, Sensitivity, Specificity) are evaluated on the test set.
      Duration is 0.00 if model was loaded from cache.
================================================================================================================================

--- 7. Preparing Latent Variable (eta) Data for Plots ---
All data for plotting is now ready.

--- 8. Visualization of Results ---

--- 8a. Generating individual regime switch plot with C.I. for selected individuals---
Individual switch plot saved to individual_switches_plot_with_ci.png

--- 8b. Generating latent variable plot with uncertainty for selected individuals---
Latent variable forecast plot saved to eta_trajectories_forecast_with_ci.png

--- 8c. Generating Aggregate Model Comparison Plot ---
Aggregate model comparison plot saved to model_comparison_plot_forecast.png

--- 9. Visualization of Individual-level Results for all individuals ---

--- 9a. Generating 4 files for individual regime switch plots with C.I. ---
Individual switch plot saved to all_individual_switches_part_1.png
Individual switch plot saved to all_individual_switches_part_2.png
Individual switch plot saved to all_individual_switches_part_3.png
Individual switch plot saved to all_individual_switches_part_4.png

--- 9b. Generating 4 files for latent variable plots with uncertainty ---
Latent variable plot saved to all_eta_trajectories_part_1.png
Latent variable plot saved to all_eta_trajectories_part_2.png
Latent variable plot saved to all_eta_trajectories_part_3.png
Latent variable plot saved to all_eta_trajectories_part_4.png
