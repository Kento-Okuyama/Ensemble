--- 0. Defining Parameters for the 3-to-1 Factor Regime-Switching Model ---
Using device: cpu
Time series split: 20 for training, 5 for testing.

--- 1. Generating Simulation Data ---
Loading pre-computed simulation data from 'simulation_data.pt'...
Data loading complete.

--- Splitting data into training and testing sets ---
Data splitting complete.

--- 2. Defining Common Functions ---
Calculated time weights for training (normalized for 20 steps): [0.132 0.267 0.395 0.516 0.629 0.735 0.834 0.925 1.009 1.086 1.155 1.217
 1.272 1.32  1.36  1.393 1.418 1.437 1.448 1.451]

--- 3. Estimation and Evaluation of Baseline Models ---

--- 3a. 3-Factor Model ---
Loading pre-computed 3-factor model results from 'baseline_3fac_results.pt'...
Loading complete.

--- 3b. 1-Factor Model ---
Loading pre-computed 1-factor model results from 'baseline_1fac_results.pt'...
Loading complete.

--- Pre-calculating inputs for BPS Fixed-Mixture model (using TRAINING data) ---
Pre-calculation complete.


--- 4. Defining and Training BPS Fixed-Mixture Model (mode='informative') ---
Loading pre-computed BPS Fixed-Mixture results from 'bps_fixed_mixture_results_informative.pt'...
Loading complete.

--- 5. Evaluating BPS Fixed-Mixture Model on Test Set ---
Pre-calculating inputs for full-period BPS evaluation...
Pre-calculation complete.
Test RMSE: 1.3576
Test Sensitivity: 1.0000, Specificity: 0.0217
Test Forecast SSR(eta): 373.8018


--- 6. Defining and Training the Regime-Switching Kalman Filter Model ---
Loading pre-computed RS-KF model results from 'rs_kf_results.pt'...
RS-KF Loading complete.
     -> Initializing FRS model with pre-trained baseline parameters.
     -> Initializing FRS HMM parameters by SAMPLING AROUND TRUE DGP values.


--- 7. Final Model Fit Comparison ---
=====================================================================================================================================
Model                          | Train Loss      | Test RMSE       | Test SSR (eta)  | Test Sensitivity | Test Specificity | Time (s)                 
-------------------------------------------------------------------------------------------------------------------------------------
3-Factor Model                 | 29539.2500      | 1.3702          | 788.8594        | 0.0000          | 1.0000          | 205.68 (Failed: 0/1)     
1-Factor Model                 | 29881.2207      | 1.3606          | 411.0803        | 1.0000          | 0.0000          | 466.71 (Failed: 0/1)     
BPS Hybrid Personalized        | -305.6958       | 1.3576          | 373.8018        | 1.0000          | 0.0217          | 4.35                     
Regime-Switching KF            | 28772.6152      | 1.3532          | 167.8398        | 0.9724          | 0.8841          | 2679.63 (Failed: 0/1)    

Note: Loss for Baseline/RS-KF is NegLogLikelihood. Loss for BPS is a part of ELBO.
      RMSE, SSR(eta), Sensitivity, and Specificity are directly comparable metrics.
=====================================================================================================================================
=====================================================================================================================================


--- 8. Preparing data for plotting ---
     -> Initializing FRS model with pre-trained baseline parameters.
     -> Initializing FRS HMM parameters by SAMPLING AROUND TRUE DGP values.


--- 9. Visualization of Final Results ---


--- 10. Generating Plots with Uncertainty Intervals ---

--- 10a. Generating individual regime switch plot for BPS (HMM) ---
Individual switch plot with C.I. saved to individual_switches_plot_with_ci.png

--- 10b. Generating latent variable plot with uncertainty (Filtered on Train, Forecast on Test) ---

Latent variable forecast plot with C.I. saved to eta_trajectories_forecast_with_ci.png

--- 11. Generating Aggregate Model Comparison Plot ---
Aggregate model comparison plot saved to model_comparison_plot.png
