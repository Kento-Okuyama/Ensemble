--- 0. Defining Parameters for the 3-to-1 Factor Regime-Switching Model ---
Using device: cpu
Running in-sample evaluation mode (no train-test split).

--- 1. Generating Simulation Data ---
No pre-computed data file found. Generating new simulation data...
Simulation data generated.
Saving simulation data to 'simulation_data_rw.pt'...
Data saving complete.

--- 2. Defining Common Functions ---

--- 3. Estimation of Baseline Models ---

--- 3a. 3-Factor Model ---
  [Epoch 0100] loss: 48468.1914 (Best: 48484.1719)
  [Epoch 0200] loss: 47009.0430 (Best: 47022.3555)
  [Epoch 0300] loss: 45803.0000 (Best: 45813.8984)
  [Epoch 0400] loss: 44820.2305 (Best: 44829.1406)
  [Epoch 0500] loss: 44004.0391 (Best: 44011.7070)
  [Epoch 0600] loss: 43267.8516 (Best: 43274.2734)
  [Epoch 0700] loss: 42683.9727 (Best: 42689.2969)
  [Epoch 0800] loss: 42193.9922 (Best: 42198.5000)
  [Epoch 0900] loss: 41775.6445 (Best: 41779.5273)
  [Epoch 1000] loss: 41413.6250 (Best: 41417.0195)
  [Epoch 1100] loss: 41096.2109 (Best: 41099.2031)
  [Epoch 1200] loss: 40811.8008 (Best: 40814.5273)
  [Epoch 1300] loss: 40544.1289 (Best: 40546.8047)
  [Epoch 1400] loss: 40272.1719 (Best: 40274.6758)
  [Epoch 1500] loss: 40109.2031 (Best: 40110.3828)
  [Epoch 1600] loss: 40003.9531 (Best: 40004.9609)
  [Epoch 1700] loss: 39903.7539 (Best: 39904.7852)
  [Epoch 1800] loss: 39797.0000 (Best: 39798.1328)
  [Epoch 1900] loss: 39678.0781 (Best: 39679.3281)
  [Epoch 2000] loss: 39547.7031 (Best: 39549.0430)
  [Epoch 2100] loss: 39412.7070 (Best: 39414.0547)
  [Epoch 2200] loss: 39280.1680 (Best: 39281.4609)
  [Epoch 2300] loss: 39154.4453 (Best: 39155.6602)
  [Epoch 2400] loss: 39039.6445 (Best: 39040.7188)
  [Epoch 2500] loss: 38940.2852 (Best: 38941.1875)
  [Epoch 2600] loss: 38859.0039 (Best: 38859.7227)
  [Epoch 2700] loss: 38795.1562 (Best: 38795.7188)
  [Epoch 2800] loss: 38745.8398 (Best: 38746.2695)
  [Epoch 2900] loss: 38707.6367 (Best: 38707.9727)
  [Epoch 3000] loss: 38677.6641 (Best: 38677.9297)
  [Epoch 3100] loss: 38653.8242 (Best: 38654.0352)
  [Epoch 3200] loss: 38634.6367 (Best: 38634.8086)
  [Epoch 3300] loss: 38619.0625 (Best: 38619.1992)
  [Epoch 3400] loss: 38606.3008 (Best: 38606.4180)
  [Epoch 3500] loss: 38595.7734 (Best: 38595.8672)
  [Epoch 3600] loss: 38586.9961 (Best: 38587.0781)
  [Epoch 3700] loss: 38579.6055 (Best: 38579.6719)
  [Epoch 3800] loss: 38573.2773 (Best: 38573.3438)
  [Epoch 3900] loss: 38567.7930 (Best: 38567.8398)
  [Epoch 4000] loss: 38562.9219 (Best: 38562.9688)
  [Epoch 4100] loss: 38558.5117 (Best: 38558.5508)
  [Epoch 4200] loss: 38554.4297 (Best: 38554.4727)
  [Epoch 4300] loss: 38550.5664 (Best: 38550.6094)
  [Epoch 4400] loss: 38546.8438 (Best: 38546.8711)
  [Epoch 4500] loss: 38543.1719 (Best: 38543.2070)
  [Epoch 4600] loss: 38539.4844 (Best: 38539.5156)
  [Epoch 4700] loss: 38535.7227 (Best: 38535.7578)
  [Epoch 4800] loss: 38531.8008 (Best: 38531.8398)
  [Epoch 4900] loss: 38527.6484 (Best: 38527.6914)
  [Epoch 5000] loss: 38523.1719 (Best: 38523.2188)
  [Epoch 5100] loss: 38518.2461 (Best: 38518.3008)
  [Epoch 5200] loss: 38512.7344 (Best: 38512.7930)
  [Epoch 5300] loss: 38506.4258 (Best: 38506.4961)
  [Epoch 5400] loss: 38499.0586 (Best: 38499.1367)
  [Epoch 5500] loss: 38490.2344 (Best: 38490.3359)
  [Epoch 5600] loss: 38479.0703 (Best: 38479.1992)
  [Epoch 5700] loss: 38463.2812 (Best: 38463.4648)
  [Epoch 5800] loss: 38441.6992 (Best: 38441.9453)
  [Epoch 5900] loss: 38413.5156 (Best: 38413.8438)
  [Epoch 6000] loss: 38375.2969 (Best: 38375.7539)
  [Epoch 6100] loss: 38319.5625 (Best: 38320.2383)
  [Epoch 6200] loss: 38235.6250 (Best: 38236.6211)
  [Epoch 6300] loss: 38119.7227 (Best: 38120.9844)
  [Epoch 6400] loss: 37997.9531 (Best: 37999.0352)
  [Epoch 6500] loss: 37913.3359 (Best: 37913.9492)
  [Epoch 6600] loss: 37870.4688 (Best: 37870.7617)
  [Epoch 6700] loss: 37847.9805 (Best: 37848.1641)
  [Epoch 6800] loss: 37831.4609 (Best: 37831.6172)
  [Epoch 6900] loss: 37815.8984 (Best: 37816.0547)
  [Epoch 7000] loss: 37800.5352 (Best: 37800.6797)
  [Epoch 7100] loss: 37785.8008 (Best: 37785.9414)
  [Epoch 7200] loss: 37772.1680 (Best: 37772.2930)
  [Epoch 7300] loss: 37759.7656 (Best: 37759.8867)
  [Epoch 7400] loss: 37748.3984 (Best: 37748.5039)
  [Epoch 7500] loss: 37737.7617 (Best: 37737.8594)
  [Epoch 7600] loss: 37727.6094 (Best: 37727.7109)
  [Epoch 7700] loss: 37717.8672 (Best: 37717.9688)
  [Epoch 7800] loss: 37708.6367 (Best: 37708.7227)
  [Epoch 7900] loss: 37700.0859 (Best: 37700.1680)
  [Epoch 8000] loss: 37692.4258 (Best: 37692.5000)
  [Epoch 8100] loss: 37685.8125 (Best: 37685.8750)
  [Epoch 8200] loss: 37680.3047 (Best: 37680.3477)
  [Epoch 8300] loss: 37675.8945 (Best: 37675.9375)
  [Epoch 8400] loss: 37672.5000 (Best: 37672.5273)
  [Epoch 8500] loss: 37669.9805 (Best: 37670.0078)
  [Epoch 8600] loss: 37668.2031 (Best: 37668.2148)
  [Epoch 8700] loss: 37666.9805 (Best: 37666.9844)
  [Epoch 8800] loss: 37666.1758 (Best: 37666.1797)
  [Epoch 8900] loss: 37665.6680 (Best: 37665.6680)
  [Epoch 9000] loss: 37665.3594 (Best: 37665.3633)
  [Epoch 9100] loss: 37665.1797 (Best: 37665.1836)
  [Epoch 9200] loss: 37665.0859 (Best: 37665.0820)
  [Epoch 9300] loss: 37665.0234 (Best: 37665.0195)
  [Epoch 9400] loss: 37665.0039 (Best: 37664.9922)
  [Epoch 9500] loss: 37664.9844 (Best: 37664.9805)
  [Epoch 9600] loss: 37664.9766 (Best: 37664.9727)
  [Epoch 9700] loss: 37664.9727 (Best: 37664.9688)
    -> Early stopping triggered at epoch 9756.

--- 3b. 1-Factor Model ---
  [Epoch 0100] loss: 45146.9336 (Best: 45159.6172)
  [Epoch 0200] loss: 44059.9336 (Best: 44069.3672)
  [Epoch 0300] loss: 43232.8086 (Best: 43240.0391)
  [Epoch 0400] loss: 42593.2383 (Best: 42598.8906)
  [Epoch 0500] loss: 42087.9727 (Best: 42092.5039)
  [Epoch 0600] loss: 41677.3828 (Best: 41681.1172)
  [Epoch 0700] loss: 41331.3516 (Best: 41334.5742)
  [Epoch 0800] loss: 41024.4844 (Best: 41027.4492)
  [Epoch 0900] loss: 40713.6406 (Best: 40717.0625)
  [Epoch 1000] loss: 40465.1328 (Best: 40467.3398)
  [Epoch 1100] loss: 40249.6250 (Best: 40251.7422)
  [Epoch 1200] loss: 40040.6172 (Best: 40042.6836)
  [Epoch 1300] loss: 39835.5039 (Best: 39837.5508)
  [Epoch 1400] loss: 39633.2422 (Best: 39635.2539)
  [Epoch 1500] loss: 39434.0000 (Best: 39435.9688)
  [Epoch 1600] loss: 39238.8438 (Best: 39240.7734)
  [Epoch 1700] loss: 39049.4609 (Best: 39051.3281)
  [Epoch 1800] loss: 38867.8672 (Best: 38869.6367)
  [Epoch 1900] loss: 38696.0977 (Best: 38697.7617)
  [Epoch 2000] loss: 38536.0078 (Best: 38537.5469)
  [Epoch 2100] loss: 38389.0625 (Best: 38390.4688)
  [Epoch 2200] loss: 38256.2383 (Best: 38257.4922)
  [Epoch 2300] loss: 38138.0039 (Best: 38139.1133)
  [Epoch 2400] loss: 38034.3672 (Best: 38035.3281)
  [Epoch 2500] loss: 37944.9570 (Best: 37945.7930)
  [Epoch 2600] loss: 37869.0898 (Best: 37869.7812)
  [Epoch 2700] loss: 37805.8438 (Best: 37806.4141)
  [Epoch 2800] loss: 37754.0742 (Best: 37754.5391)
  [Epoch 2900] loss: 37712.5156 (Best: 37712.8828)
  [Epoch 3000] loss: 37679.7930 (Best: 37680.0820)
  [Epoch 3100] loss: 37654.5039 (Best: 37654.7305)
  [Epoch 3200] loss: 37635.3203 (Best: 37635.4766)
  [Epoch 3300] loss: 37620.9844 (Best: 37621.1133)
  [Epoch 3400] loss: 37610.4531 (Best: 37610.5352)
  [Epoch 3500] loss: 37602.7891 (Best: 37602.8438)
  [Epoch 3600] loss: 37597.2734 (Best: 37597.3164)
  [Epoch 3700] loss: 37593.3203 (Best: 37593.3555)
  [Epoch 3800] loss: 37590.5039 (Best: 37590.5234)
  [Epoch 3900] loss: 37588.4844 (Best: 37588.4961)
  [Epoch 4000] loss: 37587.0156 (Best: 37587.0273)
  [Epoch 4100] loss: 37585.9336 (Best: 37585.9453)
  [Epoch 4200] loss: 37585.1211 (Best: 37585.1328)
  [Epoch 4300] loss: 37584.4883 (Best: 37584.4922)
  [Epoch 4400] loss: 37583.9766 (Best: 37583.9805)
  [Epoch 4500] loss: 37583.5547 (Best: 37583.5586)
  [Epoch 4600] loss: 37583.1875 (Best: 37583.1875)
  [Epoch 4700] loss: 37582.8672 (Best: 37582.8750)
  [Epoch 4800] loss: 37582.5820 (Best: 37582.5859)
  [Epoch 4900] loss: 37582.3203 (Best: 37582.3320)
  [Epoch 5000] loss: 37582.0938 (Best: 37582.0938)
  [Epoch 5100] loss: 37581.8711 (Best: 37581.8711)
  [Epoch 5200] loss: 37581.6719 (Best: 37581.6680)
  [Epoch 5300] loss: 37581.4844 (Best: 37581.4883)
  [Epoch 5400] loss: 37581.3281 (Best: 37581.3281)
  [Epoch 5500] loss: 37581.1719 (Best: 37581.1758)
  [Epoch 5600] loss: 37581.0430 (Best: 37581.0469)
  [Epoch 5700] loss: 37580.9219 (Best: 37580.9258)
  [Epoch 5800] loss: 37580.8320 (Best: 37580.8281)
  [Epoch 5900] loss: 37580.7461 (Best: 37580.7461)
  [Epoch 6000] loss: 37580.6719 (Best: 37580.6719)
  [Epoch 6100] loss: 37580.6133 (Best: 37580.6094)
  [Epoch 6200] loss: 37580.5625 (Best: 37580.5625)
  [Epoch 6300] loss: 37580.5195 (Best: 37580.5156)
  [Epoch 6400] loss: 37580.4883 (Best: 37580.4844)
  [Epoch 6500] loss: 37580.4688 (Best: 37580.4648)
  [Epoch 6600] loss: 37580.4531 (Best: 37580.4453)
  [Epoch 6700] loss: 37580.4375 (Best: 37580.4375)
  [Epoch 6800] loss: 37580.4336 (Best: 37580.4258)
    -> Early stopping triggered at epoch 6890.
Baseline model estimation complete.


--- 4. Defining and Training BPS Random-Walk Model ---
Pre-calculating inputs for BPS model...
Pre-calculation complete.
Starting BPS model training with VI...
